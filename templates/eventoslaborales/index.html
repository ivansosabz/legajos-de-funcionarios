{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Eventos Laborales{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/documentos/index.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <!-- Filtros y búsqueda -->
  <form method="get" class="mb-4">
    <div class="row g-2 align-items-end">
      <!-- Buscador -->
      <div class="col-md-4">
        <div class="input-group">
          <input type="text" name="q" class="form-control bg-dark text-light"
                 placeholder="Buscar por funcionario o motivo" value="{{ q }}">
          <button class="btn btn-outline-light" type="submit">
            <i class="bi bi-search"></i> Buscar
          </button>
        </div>
      </div>

      <!-- Dropdown Filtrar por -->
      <div class="col-md-4">
        <div class="dropdown w-100">
          <button class="btn btn-outline-light dropdown-toggle w-100" type="button" data-bs-toggle="dropdown">
            Filtrar por
          </button>
          <div class="dropdown-menu p-3 bg-dark border border-light w-100">
            <!-- Tipo de evento -->
            <div class="mb-2">
              <label class="form-label text-light">Tipo de Evento:</label>
              <select name="tipo_evento" class="form-select bg-dark text-light">
                <option value="">Todos</option>
                {% for t in tipos_evento %}
                  <option value="{{ t.value }}" {% if tipo_evento == t.value %}selected{% endif %}>
                    {{ t.label }}
                  </option>
                {% endfor %}
              </select>
            </div>


              <!-- Funcionario -->
            <div class="mb-2">
              <label for="funcionario" class="form-label text-light">Funcionario:</label>
              <select name="funcionario" id="funcionario" class="form-select bg-dark text-light">
                <option value="">Todos</option>
                {% for funcionario in funcionarios %}
                <option value="{{ funcionario.id }}" {% if request.GET.funcionario == funcionario.id|stringformat:"s" %}selected{% endif %}>
                  {{ funcionario }}
                </option>
                {% endfor %}
              </select>
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-2">Aplicar filtros</button>
          </div>
        </div>
      </div>

      <!-- Botón Nuevo Evento -->
      <div class="col-md-4">
        <a href="{% url 'insertar_evento' %}" class="btn btn-success w-100">
          <i class="bi bi-plus-circle me-1"></i> Nuevo Evento
        </a>
      </div>
    </div>
  </form>

  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Eventos Laborales</h2>
  </div>

  <!-- Tabla (igual estilo que documentos) -->
  {% if eventos %}
    <div class="table-responsive">
      <table class="table table-dark table-striped">
        <thead>
          <tr>
            <th>Funcionario</th>
            <th>Tipo</th>
            <th>Beneficio</th>
            <th>Motivo</th>
            <th>Inicio</th>
            <th>Fin</th>
            <th>Archivo</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
        {% for e in eventos %}
          <tr>
            <td>{{ e.id_funcionario }}</td>
            <td>{{ e.get_tipo_evento_display }}</td>
            <td>
              {% if e.tipo_evento == 'beneficios' and e.beneficio %}
                {{ e.get_beneficio_display }}
              {% else %}-{% endif %}
            </td>
            <td>{{ e.motivo|default:'-' }}</td>
            <td>{{ e.fecha_inicio|date:"d/m/Y" }}</td>
            <td>
              {% if e.fecha_fin %}{{ e.fecha_fin|date:"d/m/Y" }}{% else %}-{% endif %}
            </td>
            <td>
              {% if e.url_resolucion_evento %}
                <a href="{{ e.url_resolucion_evento.url }}" target="_blank" class="link-primary">
                  <i class="bi bi-eye"></i> Ver
                </a>
              {% else %}
                <span class="text-muted">Sin archivo</span>
              {% endif %}
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'editar_evento' e.id %}" class="btn btn-outline-warning">
                  <i class="bi bi-pencil-fill"></i>
                </a>
                <a href="{% url 'eliminar_evento' e.id %}"
   class="btn btn-outline-danger">
  <i class="bi bi-trash-fill"></i>
</a>

              </div>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-secondary text-center mt-4">
      <i class="bi bi-info-circle me-2"></i> No se encontraron eventos con los filtros aplicados.
    </div>
  {% endif %}
</div>
{% endblock %}
