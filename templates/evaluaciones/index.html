{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Evaluaciones{% endblock %}
{% block styles %}
<link rel="stylesheet" href="{% static 'css/documentos/index.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <form method="get" class="mb-4">
    <div class="row g-2 align-items-end">
      <div class="col-md-4">
        <div class="input-group">
          <input type="text" name="q" class="form-control bg-dark text-light"
                 placeholder="Buscar por funcionario" value="{{ q }}">
          <button class="btn btn-outline-light" type="submit">
            <i class="bi bi-search"></i> Buscar
          </button>
        </div>
      </div>

      <div class="col-md-4">
        <div class="dropdown w-100">
          <button class="btn btn-outline-light dropdown-toggle w-100" type="button" data-bs-toggle="dropdown">
            Filtrar por
          </button>
          <div class="dropdown-menu p-3 bg-dark border border-light w-100">
            <div class="mb-2">
              <label class="form-label text-light">Funcionario:</label>
              <select name="funcionario" class="form-select bg-dark text-light">
                <option value="">Todos</option>
                {% for f in funcionarios %}
                  <option value="{{ f.id }}" {% if request.GET.funcionario == f.id|stringformat:"s" %}selected{% endif %}>
                    {{ f }}
                  </option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label text-light">Tipo de personal:</label>
              <select name="tipo_personal" class="form-select bg-dark text-light">
                <option value="">Todos</option>
                {% for val, lab in TIPO_PERSONAL_CHOICES %}
                  <option value="{{ val }}" {% if tipo == val %}selected{% endif %}>{{ lab }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="mb-2">
              <label class="form-label text-light">Período:</label>
              <select name="periodo" class="form-select bg-dark text-light">
                <option value="">Todos</option>
                {% for val, lab in PERIODO_CHOICES %}
                  <option value="{{ val }}" {% if periodo == val %}selected{% endif %}>{{ lab }}</option>
                {% endfor %}
              </select>
            </div>

            <button type="submit" class="btn btn-primary w-100 mt-2">Aplicar filtros</button>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <a href="{% url 'nueva_evaluacion' %}" class="btn btn-success w-100">
          <i class="bi bi-plus-circle me-1"></i> Nueva Evaluación
        </a>
      </div>
    </div>
  </form>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Evaluaciones</h2>
  </div>

  {% if evaluaciones %}
    <div class="table-responsive">
      <table class="table table-dark table-striped">
        <thead>
          <tr>
            <th>Funcionario</th>
            <th>Tipo personal</th>
            <th>Período</th>
            <th>Fecha</th>
            <th>Acta</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for e in evaluaciones %}
          <tr>
            <td>{{ e.id_funcionario }}</td>
            <td>{{ e.get_tipo_personal_display }}</td>
            <td>{{ e.get_periodo_evaluacion_display }}</td>
            <td>{{ e.fecha_evaluacion|date:"d/m/Y" }}</td>
            <td>
              {% if e.acta_evaluacion %}
                <a href="{{ e.acta_evaluacion.url }}" target="_blank" class="link-primary">
                  <i class="bi bi-file-earmark-arrow-down"></i> Ver
                </a>
              {% else %}
                <span class="text-muted">Sin archivo</span>
              {% endif %}
            </td>
            <td>
              <div class="btn-group btn-group-sm" role="group">
                <a href="{% url 'editar_evaluacion' e.id %}" class="btn btn-outline-warning">
                  <i class="bi bi-pencil-fill"></i>
                </a>
                <a href="{% url 'eliminar_evaluacion' e.id %}" class="btn btn-outline-danger">
                  <i class="bi bi-trash-fill"></i>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-secondary text-center mt-4">
      <i class="bi bi-info-circle me-2"></i> No se encontraron evaluaciones con los filtros aplicados.
    </div>
  {% endif %}
</div>
{% endblock %}
